<html>
<head>
<meta charset='utf-8'>
<meta content='IE=edge;chrome=1' http-equiv='X-UA-Compatible'>
<title>review confident ruby</title>
<meta content='' name='description'>
<meta content='width=device-width' name='viewport'>
<link href='/css/normalize.css' rel='stylesheet'>
<link href='/css/main.css' rel='stylesheet'>
<link href='/css/bootstrap.min.css' rel='stylesheet'>
<link href='/stylesheets/background.css' rel='stylesheet'>
<link href='/stylesheets/article.css' rel='stylesheet'>
<script src='/js/vendor/modernizr-2.6.1.min.js'></script>
<script src='/js/vendor/jquery-1.8.0.min.js'></script>
<script src='/js/bootstrap.min.js'></script>
<link href="/stylesheets/rouge.css" rel="stylesheet" type="text/css" />
<link href="/stylesheets/home.css" rel="stylesheet" type="text/css" />
</head>
<body>
<header>
<nav class='navbar navbar-default' role='navigation'>
<div class='navbar-header'>
<button class='navbar-toggle' data-target='.navbar-ex1-collapse' data-toggle='collapse' type='button'>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
</button>
<a class='navbar-brand'></a>
</div>
<div class='collapse navbar-collapse navbar-ex1-collapse'>
<ul class='nav navbar-nav'>
<li>
<a href='/'>Home</a>
</li>
<li>
<a href='/feed.xml'>Feed</a>
</li>
<li>
<a href='/about'>About</a>
</li>
</ul>
</div>
</nav>
</header>
<section class='main'>
<div id='main' role='main'>
<div class='container'>
<article>
<div class='title'>
<h1 class='page-header text-center'>
review confident ruby
</h1>
</div>
<br>
<h2>再读confident ruby(performing work部分)</h2>

<p>再读confident ruby，记下以下要点。</p>

<h2>每个函数应包含4部分</h2>

<ol>
<li>collecting input</li>
<li>performing work</li>
<li>delivering result</li>
<li>handling failures</li>
</ol>

<h2>performing work的模式</h2>

<p>这个部分只有一个pattern</p>

<h3>sending a strong message</h3>

<p>要发消息给trused object,需要3个条件</p>

<ol>
<li>识别要完成工作所需要发送的消息</li>
<li>识别这些消息对应的roles</li>
<li>确保method能担任这些roles</li>
</ol>

<h4>一个从文件中读取用户信息，并发邮件的例子</h4>

<h5>需要做以下步骤</h5>

<ol>
<li>Parse the purchase records from the CSV contained in a provided IO object.</li>
<li>For each purchase record, use the record&rsquo;s email address to get the
associated customer record, or, if the email hasn&rsquo;t been seen before, create a
new customer record in our system.</li>
<li>Use the legacy record&rsquo;s product ID to find or create a product record in our
system.</li>
<li>Add the product to the customer record&rsquo;s list of purchases.</li>
<li>Notify the customer of the new location where they can download their files
and update their account info.</li>
<li>Log the successful import of the purchase record.</li>
</ol>

<h5>识别message</h5>

<ol>
<li>#parse_legacy_purchase_records.</li>
<li>For #each purchase record, use the record&rsquo;s #email_address to #get_customer.</li>
<li>Use the record&rsquo;s #product_id to #get_product.</li>
<li>#add_purchased_product to the customer record.</li>
<li>#notify_of_files_available for the purchased product.</li>
<li>#log_successful_import of the product record.</li>
</ol>

<h5>识别roles</h5>

<table><thead>
<tr>
<th>Message</th>
<th>Receiver Role</th>
</tr>
</thead><tbody>
<tr>
<td>#parse_legacy_purchase_records</td>
<td>legacy_data_parser</td>
</tr>
<tr>
<td>#each</td>
<td>purchase_list</td>
</tr>
<tr>
<td>#email_address,#product_id</td>
<td>purchase_record</td>
</tr>
<tr>
<td>#get_customer</td>
<td>customer_list</td>
</tr>
<tr>
<td>#get_product</td>
<td>product_inventory</td>
</tr>
<tr>
<td>#add_purchased_product</td>
<td>customer</td>
</tr>
<tr>
<td>#notify_of_files_available</td>
<td>customer</td>
</tr>
<tr>
<td>#log_successful_import</td>
<td>data_importer</td>
</tr>
</tbody></table>

<h4>关于duck type</h4>

<p>不要在method中再根据type写分支逻辑，而是首先找出我们需要什么样的message和role，然后确保我们在程序里只允许使用准备好的duck</p>

</article>
<div id="disqus_thread"></div>
<script type="text/javascript">
//<![CDATA[
                  var disqus_shortname = 'zyncrochinadevblog';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>
</div>
</section>
<footer>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(["_setAccount", "UA-44086232-1"]);
  _gaq.push(["_trackPageview"]);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</footer>
</body>
</html>
