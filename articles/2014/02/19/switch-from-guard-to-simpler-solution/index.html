<html>
<head>
<meta charset='utf-8'>
<meta content='IE=edge;chrome=1' http-equiv='X-UA-Compatible'>
<title>switch from guard to simpler solution</title>
<meta content='' name='description'>
<meta content='width=device-width' name='viewport'>
<link href='/css/normalize.css' rel='stylesheet'>
<link href='/css/main.css' rel='stylesheet'>
<link href='/css/bootstrap.min.css' rel='stylesheet'>
<link href='/stylesheets/background.css' rel='stylesheet'>
<link href='/stylesheets/article.css' rel='stylesheet'>
<script src='/js/vendor/modernizr-2.6.1.min.js'></script>
<script src='/js/vendor/jquery-1.8.0.min.js'></script>
<script src='/js/bootstrap.min.js'></script>
<link href="/stylesheets/rouge.css" rel="stylesheet" type="text/css" />
<link href="/stylesheets/home.css" rel="stylesheet" type="text/css" />
</head>
<body>
<header>
<nav class='navbar navbar-default' role='navigation'>
<div class='navbar-header'>
<button class='navbar-toggle' data-target='.navbar-ex1-collapse' data-toggle='collapse' type='button'>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
</button>
<a class='navbar-brand'></a>
</div>
<div class='collapse navbar-collapse navbar-ex1-collapse'>
<ul class='nav navbar-nav'>
<li>
<a href='/'>Home</a>
</li>
<li>
<a href='/feed.xml'>Feed</a>
</li>
<li>
<a href='/about'>About</a>
</li>
</ul>
</div>
</nav>
</header>
<section class='main'>
<div id='main' role='main'>
<div class='container'>
<article>
<div class='title'>
<h1 class='page-header text-center'>
switch from guard to simpler solution
</h1>
</div>
<br>
<h2>The weird problem when using guard</h2>

<p>I have recently encounter a problem: when using guard to watch file changes,
and run tasks automatically, they run multiple times, or remove the result.
<a href="https://github.com/netzpirat/guard-coffeescript/issues/28">Some similiar issues on github</a></p>

<h2>Fix the problem or avoid it</h2>

<p>It seems the problem may be caused by editor, OS, or some gems, I have tried
some time, but can&rsquo;t find a solution. All I need is just run some task
automatically when file changes. So I try this rubygem:
<a href="https://github.com/adamsanderson/when-files-change">when-files-change</a> It
should be simpler than Guard, and I don&rsquo;t need to write config file, just type:</p>
<pre class="highlight shell"><code>
when-files-change -- rake <span class="nb">test
</span>when-files-change --ignore <span class="s1">'build'</span> -- make
</code></pre>

<p>That is all. I can leave the task run by itself without manually invoke them.</p>

<h2>Guard come back to work</h2>

<p>When I create a new project later, some guard tasks run normally. Maybe my
previous problem is caused by some rubygem dependencies.</p>

<h2>Other solutions that run tasks from vim by key mappings</h2>

<h3>use tmux to run tasks asynchronously</h3>

<p>create a new tmux session:</p>
<pre class="highlight shell"><code>
tmux new-session -n development
</code></pre>

<p>tmux can send keys to another pane like</p>
<pre class="highlight shell"><code>
tmux send-keys -t development.1 <span class="s2">"echo test"</span> C-m
tmux send-keys -t development.1 <span class="s2">"rake"</span> C-m
</code></pre>

<h3>use fifo or pipe to run tasks:</h3>
<pre class="highlight shell"><code>
mkfifo <span class="nb">test</span>-commands

<span class="k">in </span>one screen: cat <span class="nb">test</span>-commands
<span class="k">in </span>another screen: <span class="nb">echo test</span>-commands
</code></pre>

<p>So now we can use the fifo/pipe to send the command over.</p>
<pre class="highlight shell"><code>sh -c <span class="s2">"</span><span class="k">$(</span>cat <span class="nb">test</span>-commands<span class="k">)</span><span class="s2">"</span>
</code></pre>

<p>to make it run forever:</p>
<pre class="highlight shell"><code><span class="k">while </span><span class="nb">true</span>; <span class="k">do </span>sh -c <span class="s2">"</span><span class="k">$(</span>cat <span class="nb">test</span>-commands<span class="k">)</span><span class="s2">"</span>; <span class="k">done</span>
</code></pre>

<p>use vim mapping to run the command on current file, silently through the shortcut, and redraw:</p>
<pre class="highlight shell"><code>remap &lt;leader&gt;E :w<span class="se">\|</span>:silent !echo <span class="s2">"bundle exec ruby %"</span> &gt; <span class="nb">test</span>-commands&lt;cr&gt;<span class="se">\|</span>:redraw!&lt;cr&gt;
</code></pre>

<p>write a run-test.sh to avoid create the fifo manually, because fifo can&rsquo;t check into git repository:</p>
<pre class="highlight shell"><code>
<span class="k">if</span> <span class="o">[</span> ! -p <span class="nb">test</span>-commands <span class="o">]</span>
<span class="k">then
  </span>mkfifo <span class="nb">test</span>-commands
<span class="k">fi

while </span><span class="nb">true</span>; <span class="k">do
  </span>sh -c <span class="s2">"</span><span class="k">$(</span>cat <span class="nb">test</span>-commands<span class="k">)</span><span class="s2">"</span>
<span class="k">done</span>

</code></pre>

</article>
<div id="disqus_thread"></div>
<script type="text/javascript">
//<![CDATA[
                  var disqus_shortname = 'zyncrochinadevblog';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>
</div>
</section>
<footer>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(["_setAccount", "UA-44086232-1"]);
  _gaq.push(["_trackPageview"]);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</footer>
</body>
</html>
